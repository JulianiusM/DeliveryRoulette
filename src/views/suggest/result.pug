//- views/suggest/result.pug – Suggestion Result (SSR)
extends ../layout

block meta
    title Suggestion Result | DeliveryRoulette

block title
    h1.card-header.text-center
        i.bi.bi-dice-5.me-2
        | Suggestion Result

block content
    - const d = data || {}
    - const result = d.result || {}
    - const r = result.restaurant || {}
    - const reason = result.reason || {}
    - const matchedDiets = reason.matchedDiets || []
    - const filters = d.filters || {}
    - const dietTagIds = filters.dietTagIds || []

    //── Restaurant Name ────────────────────────────────────
    .text-center.mb-3
        h2.text-white
            i.bi.bi-shop.me-2
            | #{r.name}

    .row.g-4
        //── Address Card ──────────────────────────────────
        .col-md-6
            .card.text-bg-dark.border-secondary
                .card-header
                    i.bi.bi-geo-alt.me-2
                    | Address
                .card-body
                    p.mb-1 #{r.addressLine1}
                    if r.addressLine2
                        p.mb-1 #{r.addressLine2}
                    p.mb-0 #{r.postalCode} #{r.city}
                    if r.country
                        p.mb-0 #{r.country}

        //── Why This Restaurant? Card ─────────────────────
        .col-md-6
            .card.text-bg-dark.border-secondary
                .card-header
                    i.bi.bi-info-circle.me-2
                    | Why This Restaurant?
                .card-body
                    if matchedDiets.length > 0
                        each diet in matchedDiets
                            .d-flex.align-items-center.mb-1
                                if diet.supported
                                    i.bi.bi-check-circle-fill.text-success.me-2
                                else
                                    i.bi.bi-x-circle-fill.text-danger.me-2
                                span #{diet.dietTagLabel}
                                if diet.source === 'override'
                                    span.badge.text-bg-primary.ms-2 Manual Override
                                else if diet.source === 'inference'
                                    span.badge.text-bg-warning.ms-2 Heuristic
                    else
                        p.text-white-50.mb-0 No diet filters applied.
                    p.text-white-50.mb-0.mt-2
                        small Selected from #{reason.totalCandidates} matching restaurant(s).

    //── Action Buttons ────────────────────────────────────
    .d-flex.justify-content-center.gap-2.mt-4
        a.btn.btn-primary(href=`/restaurants/${r.id}`)
            i.bi.bi-eye.me-1
            | View Restaurant

        //── Reroll Form (preserves filters) ───────────────
        form.d-inline(method="POST" action="/suggest")
            each tagId in dietTagIds
                input(type="hidden" name="dietTagIds" value=tagId)
            input(type="hidden" name="cuisineIncludes" value=(filters.cuisineIncludes || ''))
            input(type="hidden" name="cuisineExcludes" value=(filters.cuisineExcludes || ''))
            button.btn.btn-success(type="submit")
                i.bi.bi-dice-5.me-1
                | Try Again

        a.btn.btn-outline-light(href="/suggest")
            i.bi.bi-arrow-left.me-1
            | Back to Dashboard
